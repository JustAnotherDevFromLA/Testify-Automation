name: "Save Dashboard Changes"
description: "Commits and pushes updated dashboard and history files"
runs:
  using: "composite"
  steps:
    - name: Commit and Push Dashboard
      shell: bash
      run: |
        git config --global user.name "Testify Bot"
        git config --global user.email "bot@testify.com"
        git config --global --add safe.directory '*'
        
        # Force add ignored report files
        git add -f reports/run_history.json reports/dashboard.html
        
        # Only commit if there are changes
        if ! git diff --staged --quiet; then
          git commit -m "chore(ci): update test dashboard [skip ci]"
          
          # Pull with rebase and auto-resolve conflicts (ours/theirs strategy)
          # We prefer OUR changes (the new run data) over whatever is upstream for these specific files
          git pull --rebase -X ours origin main
          git push origin HEAD:main
        else
          echo "No changes to dashboard."
        fi
